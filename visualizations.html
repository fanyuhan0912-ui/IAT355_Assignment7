<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>EV Charging Visualization – Visualizations</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- Vega & Vega-Lite & Vega-Embed -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>

<body>
  <nav>
    <div class="container nav-inner">
      <div class="logo">
        <div class="logo-icon"></div>
        <span class="logo-text">EV Data Lab</span>
      </div>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="visualizations.html" class="active">Visualizations</a></li>
        <li><a href="about.html">About</a></li>
      </ul>
    </div>
  </nav>

  <main class="section">
    <div class="container viz-layout">
      <div>
        <div class="section-header">
          <p class="section-kicker">VISUALS</p>
          <h1 class="section-title">
            Core <span class="accent">visualizations</span> of the project
          </h1>
        </div>
        <div class="text-block">
          <p>
            This page hosts all main visualizations. For Milestone 2, each chart is
            implemented as a functional prototype and embedded directly into the
            layout below. Styling, annotation, and richer interactivity will be
            improved in later stages.
          </p>
        </div>
      </div>

      <div class="text-block">
        <p>
          Suggested reading order for users:
        </p>
        <p>
          1. Start with the map to see the spatial distribution of charging stations.<br />
          2. Move to the bar chart to compare cities in detail.<br />
          3. Finish with the timeline to understand how access has changed over time.
        </p>
      </div>
    </div>

    <div class="container" style="margin-top: 2.5rem;">
      <div class="viz-grid">
        
        <!-- vis 1 -->
        <article class="viz-card">
          <header>
            <h2 class="viz-title">City-level charging station density</h2>
            <span class="viz-tag">Map · Prototype</span>
          </header>
          <div id="cityDensityMap" style="min-height: 480px;"></div>
        </article>

        <!-- vis 2 -->
        <article class="viz-card">
          <header>
            <h2 class="viz-title">Charging stations by city</h2>
            <span class="viz-tag">Bar chart · Prototype</span>
          </header>
          <div class="viz-placeholder">
            Bar chart placeholder – you can mount your D3 / Vega-Lite chart here.
          </div>
        </article>

        <!-- vis 3 (HERE IS YOUR REAL CHART) -->
        <article class="viz-card">
          <header>
            <h2 class="viz-title">Timeline of EV infrastructure growth</h2>
            <span class="viz-tag">Line chart · Prototype</span>
          </header>
         <div id="evDualLineChart" style="margin: 30px auto;"></div>

        </article>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      Final Project – Milestone 2 · Visualizations
    </div>
  </footer>


  
  <script src="city_density_data.js"></script>
  <script>
  const cityDensitySpec = {
    $schema: "https://vega.github.io/schema/vega-lite/v5.json",
    width: "container",
    height: 480,
    autosize: { type: "fit", contains: "padding" },
    config: {
      background: "transparent",
      view: { stroke: null },
      legend: { labelColor: "#cbd5e1", titleColor: "#e2e8f0" },
      axis: { labelColor: "#cbd5e1", titleColor: "#e2e8f0" }
    },

    projection: { type: "mercator", center: [-96, 58], scale: 520 },

    layer: [
      {
        data: {
          url: "https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json",
          format: { type: "topojson", feature: "countries" }
        },
        transform: [{ filter: "datum.id == 124" }], // 124 = Canada (ISO numeric)
        mark: { type: "geoshape", fill: "#bccfe6", stroke: "#8ba7c4", strokeWidth: 1.2, opacity: 0.9 }
      },
      {
        data: { values: cityDensityData },
        mark: { type: "circle", color: "#1f7a8c", opacity: 0.75 },
        encoding: {
          longitude: { field: "lon", type: "quantitative" },
          latitude: { field: "lat", type: "quantitative" },
          size: {
            field: "stationCount",
            type: "quantitative",
            title: "Charging stations",
            scale: { range: [40, 1200] }
          },
          tooltip: [
            { field: "City", type: "nominal" },
            { field: "ProvName", title: "Province", type: "nominal" },
            { field: "stationCount", title: "Charging stations", type: "quantitative" },
            { field: "totalPorts", title: "Total ports", type: "quantitative" }
          ]
        }
      }
    ]
  };


  const dualSpec = {
  $schema: "https://vega.github.io/schema/vega-lite/v5.json",

  width: 650,
  height: 420,

  data: {
    url: "ev_data.csv",
    format: { type: "csv" }
  },

  layer: [
    // EV Registrations (Left Axis)
    {
      mark: { type: "line", point: true },
      encoding: {
        x: {
          field: "Year",
          type: "ordinal",
          title: "Year",
          axis: { labelAngle: 0 }   // 横向年份
        },
        y: {
          field: "EV_Registrations",
          type: "quantitative",
          title: "EV Registrations",
          axis: {
            titleColor: "#e67e22",
            labelColor: "#e67e22"
          }
        },
        color: { value: "#e67e22" }
      }
    },

    // Charging Stations (Right Axis)
    {
      mark: { type: "line", point: true, strokeDash: [4, 4] },
      encoding: {
        x: {
          field: "Year",
          type: "ordinal",
          axis: { labelAngle: 0 }
        },
        y: {
          field: "Charging_Stations",
          type: "quantitative",
          axis: {
            title: "Number of Public Charging Stations",
            orient: "right",
            titleColor: "#2980b9",
            labelColor: "#2980b9"
          }
        },
        color: { value: "#2980b9" }
      }
    }
  ],

  resolve: { scale: { y: "independent" } }
};



  vegaEmbed("#evDualLineChart", dualSpec).catch(console.error);
  vegaEmbed("#cityDensityMap", cityDensitySpec, { renderer: "canvas", actions: false }).catch(console.error);
</script>


</body>
</html>
