<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>EV Charging Visualization – Visualizations</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- Vega & Vega-Lite & Vega-Embed -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>

<body>
  <nav>
    <div class="container nav-inner">
      <div class="logo">
        <div class="logo-icon"></div>
        <span class="logo-text">EV Data Lab</span>
      </div>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="visualizations.html" class="active">Visualizations</a></li>
        <li><a href="about.html">About</a></li>
      </ul>
    </div>
  </nav>

  <main class="section">
    <div class="container viz-layout">
      <div>
        <div class="section-header">
          <p class="section-kicker">VISUALS</p>
          <h1 class="section-title">
            Core <span class="accent">visualizations</span> of the project
          </h1>
        </div>
        <div class="text-block">
          <p>
            This page hosts all main visualizations. For Milestone 2, each chart is
            implemented as a functional prototype and embedded directly into the
            layout below. Styling, annotation, and richer interactivity will be
            improved in later stages.
          </p>
        </div>
      </div>

      <div class="text-block">
        <p>Suggested reading order for users:</p>
        <p>
          1. Start with the map to see the spatial distribution of charging stations.<br />
          2. Move to the bar chart to compare cities in detail.<br />
          3. Finish with the timeline to understand how access has changed over time.
        </p>
      </div>
    </div>

    <div class="container" style="margin-top: 2.5rem;">
      <div class="viz-grid">

        <!-- vis 1 -->
        <article class="viz-card">
          <header>
            <h2 class="viz-title">Provincial charging station coverage</h2>
            <span class="viz-tag" style="margin-bottom: 1rem">Map · Prototype</span>
          </header>
          <div id="cityDensityMap" style="min-height: 480px;"></div>
          <p>This map shows the number of EV charging stations across Canadian provinces and territories. British Columbia and Quebec have the highest coverage, while central provinces show moderate availability. Northern regions have very limited charging infrastructure due to low population density and geographic challenges.</p>
        </article>

        <!-- vis 2 -->
        <article class="viz-card">
          <header>
            <h2 class="viz-title">Charging stations in BC over time</h2>
            <span class="viz-tag">Bar chart · Prototype</span>
          </header>
          <div id="cityBarChart" class="viz-placeholder"></div>
          <p>This bar chart shows the growth of public EV charging stations in British Columbia from 2015 to 2024. The number of stations has increased steadily each year, with particularly rapid expansion after 2019, rising from 2,100 stations to 5,300 in 2024. This trend highlights BC’s strong investment and leadership in EV infrastructure development.</p>
        </article>

        <!-- vis 3 -->
        <article class="viz-card">
          <header>
            <h2 class="viz-title">Timeline of EV infrastructure growth</h2>
            <span class="viz-tag">Line chart · Prototype</span>
          </header>
          <div id="evDualLineChart" style="margin: 30px auto;"></div>
          <p>This line chart compares the growth of EV registrations and public charging stations over time. Both metrics rise steadily from 2015 to 2024, with EV adoption accelerating sharply after 2019. Charging infrastructure expands in parallel to support this demand, highlighting a strong correlation between EV uptake and infrastructure development.</p>
        </article>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      Final Project – Milestone 2 · Visualizations
    </div>
  </footer>


  <script>
 const cityDensitySpec = {
  $schema: "https://vega.github.io/schema/vega-lite/v5.json",
  width: "container",
  height: 550,
  background: "#ffffff",

  projection: {
    type: "mercator",
    center: [-96, 60],
    scale: 400
  },

  layer: [
 
    {
      data: {
        url: "canada_outline.geojson",
        format: {
          type: "json",
          property: "features"   
        }
      },

      transform: [
    
        {
          calculate:
        
            "datum.properties.NAME == 'Newfoundland  & Labrador' ? 'Newfoundland & Labrador' : datum.properties.NAME",
          as: "ProvinceName"
        },
        {
          lookup: "ProvinceName",
          from: {
            data: { url: "province_charging.csv" },
            key: "Province",
            fields: ["Charging_Stations"]
          }
        }
      ],

      mark: {
        type: "geoshape",
        stroke: "#111827",
        strokeWidth: 0.5
      },

      encoding: {
        color: {
          field: "Charging_Stations",
          type: "quantitative",
          title: "Charging stations",
          scale: { range: ["#d9f99d", "#15803d"] }, 
          legend: {
            title: "Charging stations",
       
          }
        },
        tooltip: [
          { field: "ProvinceName", title: "Province" },
          { field: "Charging_Stations", title: "Charging stations" }
        ]
      }

    },

   
    {
      data: {
        values: [
          { province: "Yukon Territory", lon: -135, lat: 63.8 },
          { province: "Northwest Territories", lon: -122, lat: 64.7 },
          { province: "Nunavut", lon: -95, lat: 67.5 },
          { province: "British Columbia", lon: -124.5, lat: 53 },
          { province: "Alberta", lon: -114, lat: 54.5 },
          { province: "Saskatchewan", lon: -105, lat: 54.5 },
          { province: "Manitoba", lon: -97.5, lat: 54.8 },
          { province: "Ontario", lon: -85, lat: 50.5 },
          { province: "Quebec", lon: -71, lat: 52 },
          { province: "New Brunswick", lon: -66, lat: 47.5 },
          { province: "Nova Scotia", lon: -63.5, lat: 44.8 },
          { province: "Prince Edward Island", lon: -62.7, lat: 46.7 },
          { province: "Newfoundland & Labrador", lon: -58.7, lat: 53.5 }
        ]
      },

      transform: [
        {
          lookup: "province",
          from: {
            data: { url: "province_charging.csv" },
            key: "Province",
            fields: ["Charging_Stations"]
          }
        }
      ],

      mark: {
        type: "text",
        fontSize: 12,
        color: "#111827",
        fontWeight: 700
      },

      encoding: {
        longitude: { field: "lon", type: "quantitative" },
        latitude: { field: "lat", type: "quantitative" },
        text: {
          field: "Charging_Stations",
          type: "quantitative",
          format: ".0f"
        },
        tooltip: [
          { field: "province", title: "Province" },
          { field: "Charging_Stations", title: "Charging stations" }
        ]
      }
    },
    {
    data: {
      values: [
        { province: "Yukon Territory", lon: -135, lat: 63.8 },
        { province: "Northwest Territories", lon: -122, lat: 64.7 },
        { province: "Nunavut", lon: -95, lat: 67.5 },
        { province: "British Columbia", lon: -124.5, lat: 53 },
        { province: "Alberta", lon: -114, lat: 54.5 },
        { province: "Saskatchewan", lon: -105, lat: 54.5 },
        { province: "Manitoba", lon: -97.5, lat: 54.8 },
        { province: "Ontario", lon: -85, lat: 50.5 },
        { province: "Quebec", lon: -71, lat: 52 },
        { province: "New Brunswick", lon: -66, lat: 47.5 },
        { province: "Nova Scotia", lon: -63.5, lat: 44.8 },
        { province: "Prince Edward Island", lon: -62.7, lat: 46.7 },
        { province: "Newfoundland & Labrador", lon: -58.7, lat: 53.5 }
      ]
    },
    mark: {
      type: "text",
      dy: -14,                
      fontSize: 10,
      color: "#000000",
      fontWeight: 600
    },
    encoding: {
      longitude: { field: "lon", type: "quantitative" },
      latitude: { field: "lat", type: "quantitative" },
      text: { field: "province", type: "nominal" }
    }
  }


  ]
};


  //vis 2
    const cityBarSpec = {
      $schema: "https://vega.github.io/schema/vega-lite/v5.json",
      description: "Bar chart of public charging stations in BC using ev_data.csv.",
      background: "transparent",
      width: "container",
      height: 260,

      data: {
        url: "ev_data.csv",
        format: { type: "csv" }
      },

      mark: {
        type: "bar",
        cornerRadiusTopLeft: 10,
        cornerRadiusTopRight: 10
      },

      encoding: {
        x: {
          field: "Year",
          type: "ordinal",
          title: "Year",
          axis: {
            labelAngle: 0,
            labelColor: "#9ca3af",
            titleColor: "#9ca3af"
          }
        },
        y: {
          field: "Charging_Stations",
          type: "quantitative",
          title: "Number of Public Charging Stations",
          axis: {
            labelColor: "#e5f4ff",
            titleColor: "#9ca3af",
            gridColor: "rgba(148,163,184,0.25)",
            tickColor: "rgba(148,163,184,0.4)"
          }
        },
        color: {
          field: "Year",
          type: "nominal",
          legend: null,
          scale: {
            "range": ["#e8f7ec","#d4f0dd","#b9e6c8","#9eddb3","#84d49e","#6acb89","#4fbf73","#33b35d","#1fa84f","#16a34a"]

          }
        },
        tooltip: [
          { field: "Year", type: "ordinal", title: "Year" },
          {
            field: "Charging_Stations",
            type: "quantitative",
            title: "Charging stations"
          }
        ]
      },

      layer: [
        {
          mark: {
            type: "bar",
            cornerRadiusTopLeft: 10,
            cornerRadiusTopRight: 10
          }
        },
        {
          mark: {
            type: "text",
            dy: -6,
            fontSize: 11,
            fontWeight: "600",
            color: "#e5f4ff"
          },
          encoding: {
            text: {
              field: "Charging_Stations",
              type: "quantitative"
            }
          }
        }
      ],

      view: {
        stroke: "transparent"
      }
    };

    const dualSpec = {
      $schema: "https://vega.github.io/schema/vega-lite/v5.json",
      width: 650,
      height: 420,
      data: { url: "ev_data.csv", format: { type: "csv" } },
      layer: [
        {
          mark: { type: "line", point: true },
          encoding: {
            x: {
              field: "Year",
              type: "ordinal",
              title: "Year",
              axis: { labelAngle: 0 }
            },
            y: {
              field: "EV_Registrations",
              type: "quantitative",
              title: "EV Registrations",
              axis: {
                titleColor: "#e67e22",
                labelColor: "#e67e22"
              }
            },
            color: { value: "#e67e22" }
          }
        },
        {
          mark: { type: "line", point: true, strokeDash: [4, 4] },
          encoding: {
            x: {
              field: "Year",
              type: "ordinal",
              axis: { labelAngle: 0 }
            },
            y: {
              field: "Charging_Stations",
              type: "quantitative",
              axis: {
                title: "Number of Public Charging Stations",
                orient: "right",
                titleColor: "#2980b9",
                labelColor: "#2980b9"
              }
            },
            color: { value: "#2980b9" }
          }
        }
      ],
      resolve: { scale: { y: "independent" } }
    };

    // --- 4. Render all three charts ---
    vegaEmbed("#cityDensityMap", cityDensitySpec, { renderer: "canvas", actions: false }).catch(console.error);
    vegaEmbed("#cityBarChart", cityBarSpec, { actions: false }).catch(console.error);
    vegaEmbed("#evDualLineChart", dualSpec, { actions: false }).catch(console.error);
  </script>
</body>

</html>
