<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>EV Charging Visualization – Visualizations</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- Vega & Vega-Lite & Vega-Embed -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>

<body>
  <nav>
    <div class="container nav-inner">
      <div class="logo">
        <div class="logo-icon"></div>
        <span class="logo-text">EV Data Lab</span>
      </div>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="visualizations.html" class="active">Visualizations</a></li>
        <li><a href="about.html">About</a></li>
      </ul>
    </div>
  </nav>

  <main class="section">
    <div class="container viz-layout">
      <div>
        <div class="section-header">
          <p class="section-kicker">VISUALS</p>
          <h1 class="section-title">
            Core <span class="accent">visualizations</span> of the project
          </h1>
        </div>
        <div class="text-block">
          <p>
            This page hosts all main visualizations. For Milestone 2, each chart is
            implemented as a functional prototype and embedded directly into the
            layout below. Styling, annotation, and richer interactivity will be
            improved in later stages.
          </p>
        </div>
      </div>

      <div class="text-block">
        <p>
          Suggested reading order for users:
        </p>
        <p>
          1. Start with the map to see the spatial distribution of charging stations.<br />
          2. Move to the bar chart to compare cities in detail.<br />
          3. Finish with the timeline to understand how access has changed over time.
        </p>
      </div>
    </div>

    <div class="container" style="margin-top: 2.5rem;">
      <div class="viz-grid">

        <!-- vis 1 -->
        <article class="viz-card">
          <header>
            <h2 class="viz-title">City-level charging station density</h2>
            <span class="viz-tag">Map · Prototype</span>
          </header>
          <div id="cityDensityMap" style="min-height: 480px;"></div>
        </article>

        <!-- vis 2 -->
        <article class="viz-card">
          <header>
            <h2 class="viz-title">Charging stations by city</h2>
            <span class="viz-tag">Bar chart · Prototype</span>
          </header>
          <!-- Vega-Lite will render the bar chart into this div -->
          <div id="cityBarChart" class="viz-placeholder"></div>
        </article>

        <!-- vis 3 -->
        <article class="viz-card">
          <header>
            <h2 class="viz-title">Timeline of EV infrastructure growth</h2>
            <span class="viz-tag">Line chart · Prototype</span>
          </header>
          <div id="evDualLineChart" style="margin: 30px auto;;"></div>

        </article>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      Final Project – Milestone 2 · Visualizations
    </div>
  </footer>

  <!-- Data & specs -->
  <script src="city_density_data.js"></script>


  <script>
    const dualSpec = {
      $schema: "https://vega.github.io/schema/vega-lite/v5.json",

      width: 650,
      height: 420,

      data: {
        url: "ev_data.csv",
        format: { type: "csv" }
      },

      layer: [
        // EV Registrations (Left Axis)
        {
          mark: { type: "line", point: true },
          encoding: {
            x: {
              field: "Year",
              type: "ordinal",
              title: "Year",
              axis: { labelAngle: 0 }   // 横向年份
            },
            y: {
              field: "EV_Registrations",
              type: "quantitative",
              title: "EV Registrations",
              axis: {
                titleColor: "#e67e22",
                labelColor: "#e67e22"
              }
            },
            color: { value: "#e67e22" }
          }
        },

        // Charging Stations (Right Axis)
        {
          mark: { type: "line", point: true, strokeDash: [4, 4] },
          encoding: {
            x: {
              field: "Year",
              type: "ordinal",
              axis: { labelAngle: 0 }
            },
            y: {
              field: "Charging_Stations",
              type: "quantitative",
              axis: {
                title: "Number of Public Charging Stations",
                orient: "right",
                titleColor: "#2980b9",
                labelColor: "#2980b9"
              }
            },
            color: { value: "#2980b9" }
          }
        }
      ],

      resolve: { scale: { y: "independent" } }
    };



    vegaEmbed("#evDualLineChart", dualSpec).catch(console.error);

    // ============================
    // NEW: Bar chart – Charging stations by city
    // ============================
    // Fake / prototype data: you can adjust the numbers later
    const cityBarSpec = {
      $schema: "https://vega.github.io/schema/vega-lite/v5.json",
      description: "Bar chart of public charging stations in BC using ev_data.csv.",
      background: "transparent",
      width: "container",
      height: 260,

      data: {
        url: "ev_data.csv",
        format: { type: "csv" }
      },

      mark: {
        type: "bar",
        cornerRadiusTopLeft: 10,
        cornerRadiusTopRight: 10
      },

      encoding: {
        x: {
          field: "Year",
          type: "ordinal",
          title: "Year",
          axis: {
            labelAngle: 0,
            labelColor: "#e5f4ff",
            titleColor: "#9ca3af"
          }
        },
        y: {
          field: "Charging_Stations",
          type: "quantitative",
          title: "Number of Public Charging Stations",
          axis: {
            labelColor: "#e5f4ff",
            titleColor: "#9ca3af",
            gridColor: "rgba(148,163,184,0.25)",
            tickColor: "rgba(148,163,184,0.4)"
          }
        },
        color: {
          field: "Year",
          type: "nominal",
          legend: null,
          scale: {
            range: [
              "#22c55e",
              "#16a34a",
              "#22c55e",
              "#4ade80",
              "#86efac",
              "#38bdf8",
              "#0ea5e9",
              "#6366f1",
              "#a855f7",
              "#f97316"
            ]
          }
        },
        tooltip: [
          { field: "Year", type: "ordinal", title: "Year" },
          {
            field: "Charging_Stations",
            type: "quantitative",
            title: "Charging stations"
          }
        ]
      },

      layer: [
        // bars themselves
        {
          mark: {
            type: "bar",
            cornerRadiusTopLeft: 10,
            cornerRadiusTopRight: 10
          }
        },

        // value labels
        {
          mark: {
            type: "text",
            dy: -6,
            fontSize: 11,
            fontWeight: "600",
            color: "#e5f4ff"
          },
          encoding: {
            text: {
              field: "Charging_Stations",
              type: "quantitative"
            }
          }
        }
      ],

      view: {
        stroke: "transparent"
      }
    };

    // Render bar chart in the second card
    vegaEmbed("#cityBarChart", cityBarSpec, { actions: false }).catch(console.error);
  </script>

    const dualSpec = {
      $schema: "https://vega.github.io/schema/vega-lite/v5.json",
      width: 650,
      height: 420,
      data: { url: "ev_data.csv", format: { type: "csv" } },
      layer: [
        {
          mark: { type: "line", point: true },
          encoding: {
            x: {
              field: "Year",
              type: "ordinal",
              title: "Year",
              axis: { labelAngle: 0 }
            },
            y: {
              field: "EV_Registrations",
              type: "quantitative",
              title: "EV Registrations",
              axis: {
                titleColor: "#e67e22",
                labelColor: "#e67e22"
              }
            },
            color: { value: "#e67e22" }
          }
        },
        {
          mark: { type: "line", point: true, strokeDash: [4, 4] },
          encoding: {
            x: {
              field: "Year",
              type: "ordinal",
              axis: { labelAngle: 0 }
            },
            y: {
              field: "Charging_Stations",
              type: "quantitative",
              axis: {
                title: "Number of Public Charging Stations",
                orient: "right",
                titleColor: "#2980b9",
                labelColor: "#2980b9"
              }
            },
            color: { value: "#2980b9" }
          }
        }
      ],
      resolve: { scale: { y: "independent" } }
    };

    vegaEmbed("#evDualLineChart", dualSpec).catch(console.error);
    vegaEmbed("#cityDensityMap", cityDensitySpec, { renderer: "canvas", actions: false }).catch(console.error);
  </script>
</body>

</html>