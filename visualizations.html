<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>EV Charging Visualization – Visualizations</title>
  <link rel="stylesheet" href="styles.css" />

  <!-- Vega & Vega-Lite & Vega-Embed -->
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>

<body>
  <nav>
    <div class="container nav-inner">
      <div class="logo">
        <div class="logo-icon"></div>
        <span class="logo-text">EV Data Lab</span>
      </div>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="visualizations.html" class="active">Visualizations</a></li>
        <li><a href="about.html">About</a></li>
      </ul>
    </div>
  </nav>

  <main class="section">
    <div class="container viz-layout">
      <div>
        <div class="section-header">
          <p class="section-kicker">VISUALS</p>
          <h1 class="section-title">
            Core <span class="accent">visualizations</span> of the project
          </h1>
        </div>
        <div class="text-block">
          <p>
            This page hosts all main visualizations. For Milestone 2, each chart is
            implemented as a functional prototype and embedded directly into the
            layout below. Styling, annotation, and richer interactivity will be
            improved in later stages.
          </p>
        </div>
      </div>

      <div class="text-block">
        <p>
          Suggested reading order for users:
        </p>
        <p>
          1. Start with the map to see the spatial distribution of charging stations.<br />
          2. Move to the bar chart to compare cities in detail.<br />
          3. Finish with the timeline to understand how access has changed over time.
        </p>
      </div>
    </div>

    <div class="container" style="margin-top: 2.5rem;">
      <div class="viz-grid">
        
        <!-- vis 1 -->
        <article class="viz-card">
          <header>
            <h2 class="viz-title">City-level charging station density</h2>
            <span class="viz-tag">Map · Prototype</span>
          </header>
          <div id="cityDensityMap" style="min-height: 480px;"></div>
        </article>

        <!-- vis 2 -->
        <article class="viz-card">
          <header>
            <h2 class="viz-title">Charging stations by city</h2>
            <span class="viz-tag">Bar chart · Prototype</span>
          </header>
          <div class="viz-placeholder">
            Bar chart placeholder – you can mount your D3 / Vega-Lite chart here.
          </div>
        </article>

        <!-- vis 3 -->
        <article class="viz-card">
          <header>
            <h2 class="viz-title">Timeline of EV infrastructure growth</h2>
            <span class="viz-tag">Line chart · Prototype</span>
          </header>
          <div id="evDualLineChart" style="margin: 30px auto;"></div>
        </article>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      Final Project – Milestone 2 · Visualizations
    </div>
  </footer>

  <!-- Data & specs -->
  <script src="city_density_data.js"></script>

  <script>
    const cityDensitySpec = {
      $schema: "https://vega.github.io/schema/vega-lite/v5.json",
      width: "container",
      height: 480,
      autosize: { type: "fit", contains: "padding" },
      config: {
        background: "transparent",
        view: { stroke: null },
        legend: { labelColor: "#cbd5e1", titleColor: "#e2e8f0" },
        axis: { labelColor: "#cbd5e1", titleColor: "#e2e8f0" }
      },

      projection: {
        type: "mercator",
        center: [-96, 60],
        scale: 450
      },

      layer: [
        {
          // Canada outline from CDN
          data: {
            url: "https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json",
            format: { type: "topojson", feature: "countries" }
          },
          transform: [
            { filter: "datum.properties.name === 'Canada'" }
          ],
          mark: {
            type: "geoshape",
            fill: "#ff4d4d",
            stroke: "#ff1a1a",
            strokeWidth: 1.2,
            opacity: 0.5
          }
        },

        {
          data: { values: cityDensityData },
          mark: { type: "circle", opacity: 0.85 },
          encoding: {
            longitude: { field: "lon", type: "quantitative" },
            latitude: { field: "lat", type: "quantitative" },

            // size controls bubble radius, legend turned off
            size: {
              field: "stationCount",
              type: "quantitative",
              scale: { range: [40, 1200] },
              legend: null
            },

            // color legend with visually distinct categories
            color: {
              field: "stationCount",
              type: "quantitative",
              scale: {
                domain: [0, 200, 400, 600, 800],
                range: ["#4ade80", "#22c55e", "#eab308", "#f97316", "#ef4444"] // green → yellow → orange → red
              },
              legend: {
                title: "Charging stations",
                labelColor: "#cbd5e1",
                titleColor: "#e2e8f0",
                format: ".0f"
              }
            },

            tooltip: [
              { field: "City", type: "nominal" },
              { field: "ProvName", title: "Province", type: "nominal" },
              { field: "stationCount", title: "Charging stations", type: "quantitative" },
              { field: "totalPorts", title: "Total ports", type: "quantitative" }
            ]
          }
        },

        {
          data: {
            values: [
              { label: "Yukon", lon: -135, lat: 63.8, dx: 0, dy: 0 },
              { label: "Northwest Territories", lon: -122, lat: 64.7, dx: 0, dy: 0 },
              { label: "Nunavut", lon: -95, lat: 67.5, dx: 0, dy: 0 },
              { label: "British Columbia", lon: -124.5, lat: 53, dx: 0, dy: 0 },
              { label: "Alberta", lon: -114, lat: 54.5, dx: 0, dy: 0 },
              { label: "Saskatchewan", lon: -105, lat: 54.5, dx: 0, dy: 0 },
              { label: "Manitoba", lon: -97.5, lat: 54.8, dx: 0, dy: 0 },
              { label: "Ontario", lon: -85, lat: 50.5, dx: 0, dy: 0 },
              { label: "Quebec", lon: -71, lat: 52, dx: 0, dy: 0 },
              { label: "New Brunswick", lon: -66, lat: 47.5, dx: -12, dy: -10 },
              { label: "Nova Scotia", lon: -63.5, lat: 44.8, dx: 0, dy: 12 },
              { label: "Prince Edward Island", lon: -62.7, lat: 46.7, dx: 14, dy: 0 },
              { label: "Newfoundland and Labrador", lon: -58.7, lat: 53.5, dx: 0, dy: 0 }
            ]
          },
          mark: {
            type: "text",
            fontSize: 11,
            color: "#e8f0fa",
            fontWeight: 600,
            opacity: 0.9
          },
          encoding: {
            longitude: { field: "lon", type: "quantitative" },
            latitude: { field: "lat", type: "quantitative" },
            text: { field: "label", type: "nominal" },
            dx: { field: "dx", type: "quantitative" },
            dy: { field: "dy", type: "quantitative" }
          }
        }
      ]
    };

    const dualSpec = {
      $schema: "https://vega.github.io/schema/vega-lite/v5.json",
      width: 650,
      height: 420,
      data: { url: "ev_data.csv", format: { type: "csv" } },
      layer: [
        {
          mark: { type: "line", point: true },
          encoding: {
            x: {
              field: "Year",
              type: "ordinal",
              title: "Year",
              axis: { labelAngle: 0 }
            },
            y: {
              field: "EV_Registrations",
              type: "quantitative",
              title: "EV Registrations",
              axis: {
                titleColor: "#e67e22",
                labelColor: "#e67e22"
              }
            },
            color: { value: "#e67e22" }
          }
        },
        {
          mark: { type: "line", point: true, strokeDash: [4, 4] },
          encoding: {
            x: {
              field: "Year",
              type: "ordinal",
              axis: { labelAngle: 0 }
            },
            y: {
              field: "Charging_Stations",
              type: "quantitative",
              axis: {
                title: "Number of Public Charging Stations",
                orient: "right",
                titleColor: "#2980b9",
                labelColor: "#2980b9"
              }
            },
            color: { value: "#2980b9" }
          }
        }
      ],
      resolve: { scale: { y: "independent" } }
    };

    vegaEmbed("#evDualLineChart", dualSpec).catch(console.error);
    vegaEmbed("#cityDensityMap", cityDensitySpec, { renderer: "canvas", actions: false }).catch(console.error);
  </script>
</body>
</html>
